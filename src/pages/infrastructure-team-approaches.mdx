---
slug: "/blog/core-of-devops-processes-in-org"
date: "2021-11-21"
author: "Евгений"
keywords: devops,принципы девопс,скорость инфраструктуры,командные процессы
---
# Способы организации работ над инфраструктурой

<!-- cut -->
За много лет мне довелось повидать много различных моделей организации работ над инфраструктурой.
В этой статье я бы хотел бы систематизировать увиденное и описать вкратце когда и почему разные варианты стоит предпочесть другим.
Важно отметить что под инфраструктурой имеется ввиду работа с железом, облаком, хостингом и т.д., то что обычно называют DevOps.
Каждый раздел описывает одну модель, плюсы и минусы, риски и в каких случаях стоит предпочесть другим.
<!-- cut -->

<h2 id={"central-team"}><a href={"#central-team"}>Центральная команда</a></h2>

В такой модели есть одна команда которая разрабатывает инфраструктуру, а остальные команды ее потребляют.
Центральная команда имеет свои внутренние процессы и структуру, а так же внешние процессы для взаимодействия с другими командами.

![Центральная команда разработки инфраструктуры, которая взаимодействует с облаком и своими серверами.](../images/central-infra-team.png)

### Плюсы

* Так как есть центральная команда - инфраструктура максимально унифицирована, зоопарк минимальный.
* Происходит обмен знаниями внутри одной команды, и есть взаимозаменяемость инженеров.
* У центральных инфраструктурных сервисов, есть команда, которая натурально может их поддерживать.
* Штаб людей может быть небольшой. Например, инфраструктурная команда из пяти человек, может обслуживать 10 команд разработки.

### Минусы

* Часто является узким горлышком, т.к. все обращаются со своими запросами в одну команду.
* Может происходить конфликт приоритетов с локальными командами, потому что внутри команды, которая потребляет инфраструктуру,
есть свои приоритеты, которые могут противоречить центральным приоритетам, которым в свою очередь следует центральная команда.
* У команд которые потребляют инфраструктуру, могут быть не развиты знания по работе с ней.

### Когда стоит использовать

Когда инфраструктуру могут потреблять многие команды, но при этом они делают очень похожие задачи.
Например, 10 инженерных команд делают один веб-проект и им нужно подымать шаблонные сервисы, тогда центральная команда работает хорошо, т.к. не допустит зоопарка на однотипных задачах.
Когда есть центральные сервисы которые должны потреблять другие команды. Например, CI или hashicorp vault.

### Когда не стоит использовать

Если в у каждой команды очень уникальная инфраструктура из-за требований, то центральная команда может работать плохо.
Точнее теряется смысл в центральной команде. Вы не будете получать те плюсы которые она дает, но при этом будет постоянные конфликты на фоне приоритетов.

### Какие проблемы придется решить

Центральной команде обязательно нужна система приоритизации работы. При этом
очень важно что бы эта система приоритизации была максимально прозрачна и понятная для тех, кому придется взаимодействовать с центральной командой.
Хорошо бы не упасть в ловушку "кто громче кричит, того и приоритеты". Рано или поздно такое случится, т.к. каждая команда стремиться оптимизировать
свои локальные приоритеты, и им не очень будет понятно почему их работа откладывается на попозже.

<h2 id={"infra-eng-in-team"}><a href={"#infra-eng-in-team"}>Инфраструктурный инженер в команду</a></h2>

В такой модели в каждой команде разработки, есть один или несколько человек, которые занимаются инфраструктурой.
Инфраструктурные инженеры полностью интегрированные в процессы конкретной команды.

![Команда в которую интегрированы инфраструктурные инженеры.](../images/infra-eng-in-team.png)

### Плюсы

* Нет конфликта приоритетов. Команда полностью внутри принимает решения о том что делать в первую очередь и что делать во вторую очередь.
* Локально решения принимаются быстро и так же быстро воплощаются в жизнь.
* Инфраструктурой заведует специалист, который хорошо разбирается в предмете.

### Минусы

* В организациях где команд много - растёт зоопарк инструментов и подходов.
Нормальная ситуация когда в одной организации используются разные CI системы, системы виртуализации, подходы к разворачиванию и т.д.
* Обмен знаний минимален, а даже если он присутствует, то многое воспринимается больше как для информации, чем как призыв к действию.
* В масштабах организации делается много одинаковой работы.
* Инженеры в командах могут быть недогружённые, если нет постоянной инфраструктурной работы и она появляется от инициативы к инициативе.
* Построение системы в котором будет достигаться минимальный уровень качества для инфраструктуры требует отдельных усилий, как для установки процесса, так и для поддержания уровня.
* У инженеров которые потребляют инфраструктуру, могут быть не развиты знания по работе с ней.

### Когда стоит использовать

Когда специфика разработки такая, что она постоянно требует уникальной инфраструктуры, ее развития и поддержки.
Например, компания занимается построением своего облака, где в каждом сервисе присутствует элемент разработки, и построение инфраструктуры.

Когда в рамках организации много средних или мелких, раздробленных, не связанных между собой проектов.
В таком случае даже при наличии центральной команды инженер вероятнее всего будет работать в контексте конкретного проекта, так что бы учесть нужды конкретного проекта.
И проще всего интегрировать инженера в команду, хотя бы на начальных этапах, пока идет построение инфраструктуры.

### Когда не стоит использовать

Когда есть много команд, которые трудятся для достижения общей цели, например работают над одним проектом и при этом потребности всех команд примерно похожи.
В таком случае инфраструктурный инженер в каждой команде с большой долей вероятности будет делать всё по своему,
и в каждой из команд получается достаточно уникальная инфраструктура, которую сложно будет эволюционировать и поддерживать.

Когда из-за различных требований, например требований по безопасности, надо централизовать инфраструктуру,
так что бы можно было строить политики безопасности вокруг центральных компонентов.
Например, обязательно иметь центральную систему CI, котора должна иметь конкретную аутентификацию и конкретно настроенные билд агенты.

### Какие проблемы придется решить

Обмен знаниями. Часто в команды интегрируется один инженер который работает с инфраструктурой,
а значит он является основным источником знаний, о том как построена инфраструктура, как ее надо поддерживать и развивать.
При таком подходе может страдать взаимозаменяемость в командах.

Зоопарк решений и инструментов. Проблемой это становиться тогда, когда в организации появляется орган ответственный за какой-то минимальный уровень качества.
Например, отдел безопасности должен обеспечить минимальный уровень качества для любой инфраструктуры, которая строится внутри организации.
Такому отделу придется разбираться в достаточно уникально построенных архитектурах и подходах, что уже по себе не маленькая работа.
Так же надо будет понять набор действий в каждом выбранном подходе, что бы достичь того самого минимального качества и проконтролировать что это будет воплощенно в жизнь.

<h2 id={"infra-in-team"}><a href={"#infra-in-team"}>Инфраструктура интегрированная в команду</a></h2>

В данном подходе, нет выделенного инженера который ответственный за инфраструктуру.
Вся команда занимается инфраструктурой и ответственность поделена между инженерами.

![Команда в котором инфраструктура разрабатывается всеми.](../images/infra-in-team.png)

### Плюсы

* Вся команда знает как устроена инфраструктура и может эффективно поддерживать приложения.
* В команде присутствует взаимозаменяемость.
* Нет конфликта приоритетов. Команда полностью внутри принимает решения о том что делать в первую очередь и что делать во вторую очередь.
* Локально решения принимаются быстро и так же быстро воплощаются в жизнь.

### Минусы

* Уровень качества инфраструктуры может страдать, так как не каждый инженер имеет специализированные знания.

### Когда стоит использовать

Стоит использовать тогда, когда есть инженеры высокого уровня и которые готовы и имеют знания о том как строить инфраструктуру.
Лучше всего работает когда приложения, живут в облаке, так как облако позволяет использовать инфраструктуру как сервис.

### Когда не стоит использовать

Когда надо строить и поддерживать собственные сервисы, которые разворачиваются в своих дата-центрах.

Когда компания философски склонна к разделению ролей в командах, и инженеры привыкли заниматься узконаправленными задачами.

### Какие проблемы придется решить

Так же как и в предыдущей схеме, зоопарк технологий. Если все команды работают в одном контексте, то нужно строить процессы обмена опытом.

Поддержание минимального уровня качества инфраструктуры. Если работа ведется в облаке, то там есть инструменты, которые позволяют проверять, то что инфраструктура удовлетворяет определенным правилам.

<h2 id={"mixed-approach"}><a href={"#mixed-approach"}>Комбинация вариантов</a></h2>

Варианты могут комбинироваться обычно в виде смешивания центральной команды с двумя другими вариантами. То есть:

1. Центральная команда и по инженеру в каждую команду разработки.
2. Центральная команда и инфраструктура интегрированная в команды разработки.

В редких специфических случаях возможен вариант развития когда инфраструктура интегрированная в команды разработки, при этом там же присутствует и инфраструктурный инженер.
Но для этого разрабатываемый продукт должен быть подмножеством построения своей инфраструктуры и работы в публичных облаках.

Комбинация подходов наследует как плохие, так и хорошие качества тех подходов которые выбраны.
Иногда негативные эффекты одного подхода могут нивелироваться позитивными качествами другого.
Например, если у нас есть центральная команда, которая разрабатывает общие подходы к инфраструктуре,
то с большой долей вероятности зоопарк технологий и подходов в командах будет меньше, чем если бы центральной команды не было.

### Когда стоит использовать

Комбинации в основном присуще большим компаниям, у которых достаточно разносторонняя разработка,
где присутствуют и элементы общего развития единообразных компонент, так и построение достаточно уникальных инфраструктурных решений.

### Когда не стоит использовать

В проектах маленьких размеров, достаточно остановиться на одном из не комбинированных подходов.

### Какие проблемы придется решить

При комбинации подходов придётся решать проблемы и строить процессы для тех подходов которые были скомбинированны :)
По этому такие схемы нужно выбирать в компаниях побольше, иначе накладные расходы на построение процессов и решение проблем,
будут выше чем польза от примененных методов.

## Заключение

За всё время работы я видел разные подходы и организации работы над инфраструктурой.
Даже довелось поработать в месте, где все эти подходы были применены в разные моменты времени, и была возможность видеть эволюцию и переход из одной модели в другую.
Из интересного - всегда оказывалось что какие-то из подходов, в разных местах плохо работают и кому-то не нравятся.
Но при этом суммарно одни подходы работали лучше, чем другие.
Вам советую выбрать тот подход, который больше подходит к текущим реалиям и пытаться заранее решить проблемные места.
